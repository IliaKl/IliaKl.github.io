<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>F</title>
	<style type="text/css">
		html {
			font-size: 1.4rem;
		}

		body {
			margin: 0;
			min-height: 100vh;
			/background-color: yellow;
		}

		#header {
			text-align: center;
			/background-color: silver;
			padding: 1rem;
		}

		#footer {
			/background-color: silver;
			padding: 1rem;
			color: silver;
		}

		#model {
 			display: -webkit-inline-flex;
			display: inline-flex; 
		}

		#container {
			width: 720px;
			height: 480px;
			background-color: silver;
			margin: 1rem;
			position: relative;
		}

		#properties {
			margin: 1rem;
			/background-color: silver;
			color: silver;
		}

		#main {
			min-height: 100vh;
			/background-color: green;
			display: -webkit-flex;
			display: flex;
			flex-direction: column;
			justify-content: space-between;
			margin: 0 1rem;
		}

		#canvas {
			z-index: 1;
		}

		#canvas_2 {
			z-index: 2;
			position: absolute;
			top: 0;
			left: 0;
		}
	</style>
</head>
<body>
	<div id="main">
		<div>
			<div id="header">
				Model
			</div>
			<div id="model">
				<div id="container">
					<canvas id="canvas"></canvas>
					<canvas id="canvas_2"></canvas>
				</div>
				<div id="properties">
					Properties
				</div>
			</div>
		</div>
		<div id="footer">
			23.12.2019
		</div>
	</div>
<script type="text/javascript">

var canvas = document.getElementById('canvas');
var ctx = canvas.getContext('2d');


	var canvas_2 = document.getElementById('canvas_2');
	var ctx_2 = canvas_2.getContext('2d');

var cWidth = 720;
var cHeight = 480;

var thickness = 130;
var roll_radius = 240;
var roll_X_pos = 300;
var roll_Y_pos = 180;


var level = cHeight-thickness;


ctx.canvas.width = cWidth;
ctx.canvas.height = cHeight;

	ctx_2.canvas.width = cWidth;
	ctx_2.canvas.height = cHeight;

	ctx_2.fillStyle = "rgba(0,0,0,0)";
	ctx_2.fillRect(0,0,cWidth,cHeight);

ctx.fillStyle = "#000000";
ctx.fillRect(0,0,cWidth,cHeight);

ctx.fillStyle = "#ffffff";
ctx.fillRect(1,1,cWidth-2,cHeight-2);

ctx.strokeStyle = "#ff0000";

/*ctx.beginPath();
ctx.moveTo(0,level);
ctx.lineTo(cWidth,level);
ctx.stroke();*/

ctx.beginPath();
//ctx.arc(roll_X_pos,roll_Y_pos,roll_radius,0,Math.PI*2,true);
ctx.stroke();

var LDA = new Array();
function createLineDataArray() {
	for (var i=0; i<cWidth; i++) {
		LDA[i] = level;
	}

	for (var i=roll_X_pos-roll_radius; i<roll_X_pos+roll_radius; i++) {
		let pozY = roll_Y_pos + Math.sqrt(roll_radius**2 - (i-roll_X_pos)**2);
		// y = y0 +- sqrt(R^2 - (x-x0)^2)
		if (LDA[i] < pozY) {
			LDA[i] = pozY;
		}
	}

	
	for (var j=3; j<10;j++) {
		var dY = j;
	for (var i = dY; i < cWidth-dY; i++ ) {
		let y0 = LDA[i-dY];
		let y1 = LDA[i];
		let y2 = LDA[i+dY];
		let q = 0.01;		
		if( y1 < (y0+y2)/2-q*10 ){
			LDA[i] = (y0+y2)/2-q*10;
		}
	}	

	for (var i = cWidth-dY; i > dY; i-- ) {
		let y0 = LDA[i-dY];
		let y1 = LDA[i];
		let y2 = LDA[i+dY];
		let q = 0.01;
		if( y1 < (y0+y2)/2-q*10 ){
			LDA[i] = (y0+y2)/2-q*10;
		}
	}
	}

	for (var i=roll_X_pos-roll_radius; i<roll_X_pos+roll_radius; i++) {
		let pozY = roll_Y_pos + Math.sqrt(roll_radius**2 - (i-roll_X_pos)**2);
		// y = y0 +- sqrt(R^2 - (x-x0)^2)
		if (LDA[i] < pozY) {
			LDA[i] = pozY;
		}
	}
}


function paintLineDataArray() {
	ctx.fillStyle = "#0000ff";
	for (var i=0; i<cWidth; i++) {
		ctx.fillRect(i,LDA[i],1,1);
	}
}


var MDA_S = new Array();
function createMatrixDataAttay_S() {
	for (var i=0; i<cWidth; i++) {
		MDA_S[i] = [];
		for (var j=0; j<cHeight;j++) {
			MDA_S[i][j]=0;
		}
	}

	for (var i=0; i<cWidth; i++) {
		var LDA_i = 1-((cHeight-LDA[i])/thickness);
		for (var j=~~LDA[i]; j<cHeight;j++) {
			MDA_S[i][j]+=LDA_i;
		}
	}

	for (var i=0; i<cWidth; i++) {
		var mass = 0.4;
		var delta_mass = mass/(cHeight-LDA[i]);
		for (var j=~~LDA[i]; j<cHeight;j++) {
			MDA_S[i][j]+= ((j-LDA[i])*delta_mass);
		}
	}

	circle(roll_X_pos, roll_Y_pos, roll_radius); 
}


function circle(x0, y0, rad) {
	//var rad = 100;
	//var x0 = 150;
	//var y0 = 150;
	var x = x0+rad;
	var y = y0;

	for (;x>=x0;) {
		if (x>=0 && y>=0) MDA_S[x][y] += 0.5;
		var ArrX = [x,x,x-1,x-1];
		var ArrY = [y,y+1,y,y+1];
		var error = rad;
		var num = 0;
		for (var n=1;n<4;n++){
			let error_loc = Math.abs((ArrX[n]-x0)**2+(ArrY[n]-y0)**2 - rad**2);
			if (error_loc<error) {
				error = error_loc;
				num = n;
			}
		}
		x = ArrX[num];
		y = ArrY[num];
	}
	for (;y>=y0;) {
		if (x>=0 && y>=0) MDA_S[x][y] += 0.5;
		var ArrX = [x,x,x-1,x-1];
		var ArrY = [y,y-1,y,y-1];
		var error = rad;
		var num = 0;
		for (var n=1;n<4;n++){
			let error_loc = Math.abs((ArrX[n]-x0)**2+(ArrY[n]-y0)**2 - rad**2);
			if (error_loc<error) {
				error = error_loc;
				num = n;
			}
		}
		x = ArrX[num];
		y = ArrY[num];
	}
	for (;x<=x0;) {
		if (x>=0 && y>=0) MDA_S[x][y] += 0.5;
		var ArrX = [x,x,x+1,x+1];
		var ArrY = [y,y-1,y,y-1];
		var error = rad;
		var num = 0;
		for (var n=1;n<4;n++){
			let error_loc = Math.abs((ArrX[n]-x0)**2+(ArrY[n]-y0)**2 - rad**2);
			if (error_loc<error) {
				error = error_loc;
				num = n;
			}
		}
		x = ArrX[num];
		y = ArrY[num];
	}
	for (;y<y0;) {
		if (x>=0 && y>=0) MDA_S[x][y] += 0.5;
		var ArrX = [x,x,x+1,x+1];
		var ArrY = [y,y+1,y,y+1];
		var error = rad;
		var num = 0;
		for (var n=1;n<4;n++){
			let error_loc = Math.abs((ArrX[n]-x0)**2+(ArrY[n]-y0)**2 - rad**2);
			if (error_loc<error) {
				error = error_loc;
				num = n;
			}
		}
		x = ArrX[num];
		y = ArrY[num];
	}
}


var MDA_DF_X = new Array();
var MDA_DF_Y = new Array();
function createMatrixDataAttay_DF() {
	for (var i=0; i<cWidth; i++) {
		MDA_DF_X[i] = [];
		MDA_DF_Y[i] = [];
		for (var j=0; j<cHeight;j++) {
			MDA_DF_X[i][j]=0;
			MDA_DF_Y[i][j]=0;
		}
	}

	for (var i=0; i<cWidth-1; i++) {
		//var dY = (LDA[i+1]-LDA[i])/(cHeight-LDA[i]);
		var dY = (cHeight-LDA[i+1]-(cHeight-LDA[i]))/*/(cHeight-LDA[i])*/;
		var H = cHeight-LDA[i];
		for (var j=~~LDA[i]; j<cHeight;j++) {
			MDA_DF_X[i][j]=0.3;
			//MDA_DF_Y[i][j]=dY*((cHeight-LDA[i])-j)/(cHeight-LDA[i])*0.05;
			MDA_DF_Y[i][j]=(dY-dY/H*(j-LDA[i]))*(-0.3);
		}
	}
	for (var j=~~LDA[cWidth-1]; j<cHeight;j++) {
		MDA_DF_X[cWidth-1][j]=MDA_DF_X[cWidth-2][j];
		MDA_DF_Y[cWidth-1][j]=MDA_DF_Y[cWidth-2][j];
	}



	/*for (var i=0; i<cWidth; i++) {
		var mass = 0.4;
		var delta_mass = mass/(cHeight-LDA[i]);
		for (var j=~~LDA[i]; j<cHeight;j++) {
			MDA_S[i][j]+= ((j-LDA[i])*delta_mass);
		}
	} */
}


function paintMatrixDataAttay_DF() {
	for (var i=0; i<cWidth; i++) {
		for (var j=0; j<cHeight;j++) {
			ctx.fillStyle = 'rgba(255,255,0,'+(Math.abs(MDA_DF_Y[i][j]))+')';
			ctx.fillRect(i,j,1,1);
			ctx.fillStyle = 'rgba(255,255,0,'+(Math.abs(MDA_DF_X[i][j]))+')';
			ctx.fillRect(i,j,1,1);
		}
	}
}


function paintMatrixDataAttay() {
	for (var i=0; i<cWidth; i++) {
		for (var j=0; j<cHeight;j++) {
			ctx.fillStyle = 'rgba(255,0,0,'+(MDA_S[i][j])+')';
			ctx.fillRect(i,j,1,1);
		}
	}
}


createLineDataArray();
createMatrixDataAttay_S();
paintMatrixDataAttay();

createMatrixDataAttay_DF();
paintMatrixDataAttay_DF();

paintLineDataArray();




var DPosX = new Array();
var DPosY = new Array();
var DPosXR = new Array();
var DPosYR = new Array();
var Time = new Date();
function createPoint() {
		

        var numD = 10;
        for (var i=0; i<numD; i++) {
        	DPosX[i] = 1+i*10;
        	DPosY[i] = 390/*+Math.sin(i/4)*(-0)*/;
        	DPosXR[i] = 0;
        	DPosYR[i] = 0;
        }
}


function Animate() {
	ctx_2.clearRect(0,0,cWidth,cHeight);


	for (var i=0; i<10; i++){

        var TimeL = new Date();
        if ((DPosX[i] < cWidth-3) && (DPosY[i] > 0) && (DPosY[i] < cHeight-1)){
        	//let mem_px = ~~DPosX[i];
        	DPosX[i] += (TimeL - Time)*0.2*MDA_DF_X[~~DPosX[i]][~~DPosY[i]];
        	DPosY[i] += (TimeL - Time)*0.2*MDA_DF_Y[~~DPosX[i]][~~DPosY[i]];

        } else {
        	DPosX[i] = 1;
        	//DPosY[i] = 370+20*i;
        	DPosXR[i] = 0;
        	DPosYR[i] = 0;
        };
        ctx_2.fillStyle = "#000000";
        ctx_2.fillRect(DPosX[i]-1,DPosY[i]-1,3,3);
    }

    	Time = TimeL;
	window.requestAnimationFrame(Animate);
}

createPoint();
Animate();

</script>
</body>
</html>